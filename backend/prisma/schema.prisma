generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model YouTuber {
  id                String    @id @default(uuid())
  name              String
  channelId         String    @unique
  channelUrl        String
  thumbnailUrl      String?
  description       String?   @db.Text
  subscriberCount   Int?
  avgScore          Float     @default(0)
  totalVideos       Int       @default(0)
  totalPredictions  Int       @default(0)
  correctPredictions Int     @default(0)
  accuracyPercent   Float     @default(0)
  lastSyncedAt      DateTime?
  videos            Video[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model Video {
  id                  String       @id @default(uuid())
  youtuberId          String
  youtuber            YouTuber     @relation(fields: [youtuberId], references: [id], onDelete: Cascade)
  videoId             String       @unique
  title               String
  url                 String
  thumbnailUrl        String?
  publishedAt         DateTime
  duration            String?
  viewCount           Int?
  transcript          String?      @db.Text
  transcriptFetchedAt DateTime?
  avgScore            Float?
  analyzed            Boolean      @default(false)
  analyzedAt          DateTime?
  predictions         Prediction[]
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  @@index([youtuberId])
  @@index([publishedAt])
  @@index([analyzed])
}

model Prediction {
  id                 String    @id @default(uuid())
  videoId            String
  video              Video     @relation(fields: [videoId], references: [id], onDelete: Cascade)
  timestampSec       Int
  timestampFormatted String
  predictionText     String    @db.Text
  predictionType     String?
  targetDate         DateTime?
  actualOutcome      String?   @db.Text
  searchSources      Json?
  accuracyScore      Float?
  explanation        String?   @db.Text
  verifiedAt         DateTime?
  createdAt          DateTime  @default(now())

  @@index([videoId])
  @@index([accuracyScore])
}
